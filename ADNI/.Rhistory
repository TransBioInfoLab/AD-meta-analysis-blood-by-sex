knitr::opts_chunk$set(echo = TRUE,warning = FALSE)
library(dplyr)
library(SummarizedExperiment)
library(ExperimentHub)
cohort <- "ADNI"
dir.base <- "~/Dropbox (BBSR)/AD-meta-analysis-blood-samples/"
dir.data <- file.path(dir.base,"datasets/",cohort,"/data/DNA_methylation")
dir.data.raw <- file.path(dir.base,"datasets/",cohort,"/data/DNA_methylation/idat")
dir.data.processed <- file.path(dir.base,"datasets/",cohort,"/data/DNA_methylation/processed")
dir.data.aux <- file.path(dir.base,"datasets/Aux/")
dir.data.pca <- file.path(dir.data,"/pca_filtering/")
dir.results <- file.path(dir.base,"analysis_results",cohort)
ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs <- readr::read_csv(
file.path(dir.data,"ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs.csv")
)
View(ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs)
ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs$ID <- paste0(
ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs$RID,
ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs$Phase,
ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs$Edate
)
head(ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs$ID)
head(colnames(betaQN_BMIQ))
head(ADNI_DNA_Methylation_SampleAnnotation_20170530_with_bs$barcodes)
clinical <- ADNIMERGE::adnimerge
clinical$ID <- paste0(clinical$RID,clinical$COLPROT,clinical$EXAMDATE)
head(clinical$ID)
clinical$ID2 <- paste0(clinical$RID,clinical$COLPROT,clinical$VISCODE)
head(clinical$ID2)
knitr::opts_chunk$set(echo = TRUE,warning = FALSE)
library(dplyr)
library(SummarizedExperiment)
library(ExperimentHub)
cohort <- "ADNI"
dir.base <- "~/Dropbox (BBSR)/AD-meta-analysis-blood-samples/"
dir.data <- file.path(dir.base,"datasets/",cohort,"/data/DNA_methylation")
dir.data.raw <- file.path(dir.base,"datasets/",cohort,"/data/DNA_methylation/idat")
dir.data.processed <- file.path(dir.base,"datasets/",cohort,"/data/DNA_methylation/processed")
dir.data.aux <- file.path(dir.base,"datasets/Aux/")
dir.data.pca <- file.path(dir.data,"/pca_filtering/")
dir.results <- file.path(dir.base,"analysis_results",cohort)
ADNI_ADvsCN <- read.csv(
file.path(dir.results,"ADNI_AD_vs_CN_results_with_blood_cell_type_proportions.csv")
)
ADNI_ADvsCN %>% filter(X1 == "cg00000658")
adni.se <- readRDS(file.path(dir.data.pca, "ADNI_QNBMIQ_PCfiltered_min_age_65.RDS"))
mvalues <- log2(assay(adni.se)/(1 - assay(adni.se)))
#  0 = control, 1 = AD, 2 = MCI
pheno <- data.frame(colData(adni.se))
dim(mvalues)
table(pheno$DIAGNOSIS, useNA = "ifany")
pheno$DIAGNOSIS <- factor(pheno$DIAGNOSIS, levels = c("CN", "MCI", "Dementia"))
table(pheno$DIAGNOSIS, useNA = "ifany")
pheno$DIAGNOSIS_merged <- ifelse(pheno$DIAGNOSIS == "CN", 0, 1)
pheno$DIAGNOSIS_merged <- factor(pheno$DIAGNOSIS_merged, levels = c(0, 1))
table(pheno$DIAGNOSIS_merged, useNA = "ifany")
pheno$barcodes <- row.names(pheno)
# add indicator for first and last visit
pheno$visit <- sub("m",  "", pheno$VISCODE)
pheno$PlateNumber <- factor(pheno$PlateNumber)
pheno <- pheno %>% dplyr::select(
c(barcodes, RID, VISCODE, PTGENDER, AGE, visit,
DIAGNOSIS, DIAGNOSIS_merged, PlateNumber,
B, NK,   CD4T, CD8T,   Mono,   Neutro, Eosino
)
)
pheno <- pheno[order(pheno$RID, pheno$visit) ,]
str(pheno)
plyr::count(pheno$DIAGNOSIS)
mvalues <- mvalues[, pheno$barcodes]
identical(colnames(mvalues), pheno$barcodes)
pheno.cn.mci <- pheno[pheno$DIAGNOSIS %in% c("CN", "MCI"),]
mvalues.cn.mci <- mvalues[, pheno.cn.mci$barcodes]
pheno.cn.mci$DIAGNOSIS <-  forcats::fct_drop(pheno.cn.mci$DIAGNOSIS)
str(pheno.cn.mci$DIAGNOSIS)
pheno.cn.ad <- pheno[pheno$DIAGNOSIS %in% c("CN", "Dementia"),]
pheno.cn.ad$DIAGNOSIS <-  forcats::fct_drop(pheno.cn.ad$DIAGNOSIS)
mvalues.cn.ad <- mvalues[, pheno.cn.ad$barcodes]
library(lmerTest)
dat.cn.ad <- data.frame(
mval = mvalues.cn.ad[row.names(mvalues.cn.ad) == "cg00000658",],
pheno.cn.ad
)
f <- lmer(
mval ~ DIAGNOSIS + AGE + PTGENDER + PlateNumber + (1|RID) + B + NK + CD4T + CD8T + Mono + Neutro,
data = dat.cn.ad
)
coef(summary(f))
